<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.kkl.kklplus.b2b.joyoung.mapper.JoyoungMaterialApplyMapper" >
    <insert id="insert"  keyProperty="id" useGeneratedKeys="true">
        INSERT INTO joyoung_material_apply(
        	kkl_master_id,
			kkl_master_no,
			audit_status,
			remark,
			return_flag,
			create_by,
			create_date,
			update_by,
			update_date,
			quarter
		) VALUES (
			#{kklMasterId},
			#{kklMasterNo},
			#{auditStatus},
			#{remark},
			#{returnFlag},
			#{createById},
			#{createDt},
			#{createById},
			#{createDt},
			#{quarter}
		)
    </insert>

	<select id="findMaterialApply" resultType="java.lang.Long">
		SELECT
			id
		FROM
			joyoung_material_apply
		WHERE
			kkl_master_no = #{kklMasterNo}
	  	limit 1
	</select>

	<select id="findMaterialApplyById" resultType="com.kkl.kklplus.b2b.joyoung.entity.JoyoungMaterialApply">
		SELECT
	  		id,
	  		process_flag
	  	FROM
	  		joyoung_material_apply
		<if test="ids != null and ids.size > 0">
	  	WHERE
			id IN
	  		<foreach collection="ids" item="id" open="(" separator="," close=")">
				#{id}
			</foreach>
		</if>
		<if test="ids == null or ids.size == 0">
			limit 0
		</if>
	</select>

	<select id="getList" resultType="com.kkl.kklplus.b2b.joyoung.entity.JoyoungMaterialApply">
		SELECT
			id,
			kkl_master_id,
			kkl_master_no,
			audit_status,
			remark,
			process_time,
			process_comment,
			create_date as 'createDt',
			quarter
		FROM
			joyoung_material_apply
		<where>
			<choose>
				<when test="beginCreateDt != null ">
					<choose>
						<when test="endCreateDt != null">
							AND create_date between #{beginCreateDt} and #{endCreateDt}
						</when>
						<otherwise>
							AND create_date >= #{beginCreateDt}
						</otherwise>
					</choose>
				</when>
				<otherwise>
					<if test="endCreateDt != null">
						AND create_date &lt;=  #{endCreateDt}
					</if>
				</otherwise>
			</choose>
			AND process_flag BETWEEN 0 AND 3
			<if test="kklMasterNo != null and kklMasterNo != ''">
				AND kkl_master_no = #{kklMasterNo}
			</if>
		</where>
	</select>

	<update id="updateProcessFlag">
		UPDATE
			joyoung_material_apply
		SET
			process_flag = #{processFlag}
			<if test="processComment != null and processComment != ''">
				,process_comment = #{processComment}
			</if>
		WHERE
			id = #{id}
	</update>
</mapper>